# v2.0 Research Summary

**Date:** 2026-02-22
**Scope:** Advanced Analytics, SMC, Optimization, Multi-Strategy, Benchmark, Report Export

## Feature Complexity Estimates

| Feature | Complexity | Days | Key Library |
|---------|-----------|------|-------------|
| Monthly Returns Heatmap | Low | 1-2 | plotly go.Heatmap |
| Rolling Sharpe/Drawdown | Medium | 2-3 | pandas rolling + plotly |
| Trade Breakdown (Session/Hour/Day) | Medium | 3-4 | plotly subplots |
| MAE/MFE Analysis | High | 4-6 | plotly scatter |
| Commission Sensitivity Sweep | Medium | 3-4 | engine re-runs |
| Order Block Detection | Medium | 3-5 | custom (ref: smartmoneyconcepts) |
| Break of Structure (BOS) | Low-Medium | 2-3 | fractal algorithm |
| FVG Mitigation Tracking | Medium | 3-4 | state machine |
| Walk-Forward Validation (Rolling) | Medium | 3-4 | custom loop |
| Robustness Report (MC + Sensitivity) | Medium | 3-4 | numpy, scipy |
| Multi-Strategy Portfolio | High | 5-7 | PortfolioRouter |
| Benchmark Comparison | Low | 1-2 | empyrical-reloaded |
| Report Export (PDF/HTML) | Low-Medium | 2-3 | weasyprint + jinja2 |
| **Total** | | **32-51** | |

## Critical Pitfalls

1. **Decimal->float boundary:** Convert only at visualization boundary (Plotly/pandas). Never run rolling() on Decimal.
2. **Lookahead in SMC:** Order Blocks need N bars confirmation — emit signal only when confirmation arrives.
3. **Walk-Forward leakage:** Reset all indicator state per window. Warm-up period inside training window.
4. **WeasyPrint on Windows:** Requires GTK3 runtime — consider WSL2 or pdfkit fallback.
5. **Multi-Strategy exposure:** Single shared Portfolio prevents impossible leverage. Attribution via metadata.
6. **FVG memory growth:** Expire stale gaps after N bars. GC pass on active dict.
7. **Monte Carlo:** Shuffle trade PnLs (not prices) — answers "how random is the trade sequence?"

## Architecture Decisions

- **Monthly Heatmap / Rolling / Breakdown / MAE-MFE:** Pure post-processing in `callbacks.py` — no engine changes.
- **Commission Sweep:** Add `commission_multiplier` parameter to `create_engine()`.
- **SMC (OB, BOS, FVG Tracking):** New strategy components in `src/strategy/smc/` — extend BaseStrategy.
- **Walk-Forward + Robustness:** New `src/optimization/` module — calls engine.run() in loops.
- **Multi-Strategy:** New `PortfolioRouter` class between strategies and Portfolio.
- **Benchmark:** `BuyAndHoldBenchmark` class alongside Portfolio.
- **Report Export:** New `src/report/` module with Jinja2 templates.

## New Dependencies

- `empyrical-reloaded` — alpha, beta, information ratio
- `weasyprint` — PDF generation (optional, WSL2 recommended)
- `jinja2` — HTML template rendering
- `kaleido` — Plotly static image export (for PDF embedding)
