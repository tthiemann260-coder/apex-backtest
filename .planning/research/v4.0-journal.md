# Research: Trading Journal — v4.0

## Data Model
- TradeJournalEntry: trade_id (UUID), symbol, side, entry/exit times+prices, quantity, commissions, slippage, gross/net PnL, MAE, MFE, duration, timeframe, strategy_name, signal_strength
- Manual fields: setup_type, market_condition, tags (list), emotion_entry, emotion_exit, rule_followed, notes, rating (1-5), screenshot_path

## Emotion Taxonomy
- Entry: CALM, CONFIDENT, ANXIOUS, FOMO, REVENGE, BORED, EXCITED, HESITANT
- Exit: DISCIPLINED, IMPATIENT, GREEDY, FEARFUL, OVERRODE_SYSTEM
- Using str(Enum) for JSON/SQLite serialization

## Tag System
- Structured: setup_type, market_condition, session, confluences (list)
- Free-form: tags list for custom annotations
- Auto-populated from SignalEvent metadata where possible

## Persistence: SQLite
- sqlite3 stdlib (zero dependencies)
- Decimal adapter: str() → Decimal() round-trip
- JSON arrays stored as TEXT columns
- Indexes on symbol, strategy, emotion, exit_time

## Integration: TradeBuilder
- Hook into Portfolio.process_fill() as observer
- Open trade tracking: _open_trades dict (symbol → entry fill state)
- MAE/MFE tracking via _price_highs/_price_lows during open position
- Trade sealed on position close → TradeJournalEntry created

## Analytics
- Tier 1: Win rate, avg win/loss, profit factor, expectancy, streaks
- Tier 2: Emotion vs PnL, setup type vs profit factor, hour/weekday heatmaps, MAE/MFE scatter
- Tier 3: Rule adherence impact, consecutive streak timeline
- All via SQL GROUP BY aggregations

## Dashboard Panels (8)
1. DataTable (sortable/filterable, row-click annotation)
2. PnL Calendar Heatmap (week × day)
3. Emotion vs PnL Bar Chart
4. MAE/MFE Scatter Plot
5. Hour-of-Day Heatmap (hour × weekday)
6. Setup Type Performance Table
7. Consecutive Streak Timeline
8. Equity Curve with Trade Markers

---
*Research completed: 2026-02-23*
