# Research: Bayesian Optimization (Optuna) — v4.0

## Optuna TPE Sampler
- Tree-structured Parzen Estimator: fits l(x)/g(x) density models
- multivariate=True for inter-parameter correlations
- n_startup_trials=10 for initial random exploration
- Free, pip install optuna (+ optuna-dashboard optional)

## Objective Function
- Single: maximize Sharpe → return float
- Multi: [maximize Sharpe, minimize DD] → return tuple, NSGA-II sampler
- Min trade filter: return float("-inf") for n_trades < threshold

## Search Spaces
- suggest_int: periods (5-50), step for meaningful granularity
- suggest_float: thresholds (0.005-0.05), log=True for orders-of-magnitude
- suggest_categorical: strategy type, position size
- Dynamic/conditional: if-branches inside objective

## Pruning
- MedianPruner (default): prune if worse than median at same step
- PercentilePruner: prune bottom N%
- Integration: trial.report(intermediate_sharpe, step) → trial.should_prune() → TrialPruned
- Steps = quarterly/yearly backtest periods

## Walk-Forward Integration
- Slice data into N rolling windows (IS + OOS)
- Per window: fresh Optuna study on IS, validate best_params on OOS
- WFO efficiency ratio: avg_OOS_sharpe / avg_IS_sharpe (> 0.5 = good)
- Below 0.5 = overfitting signal

## Visualization (all return Plotly figures)
- plot_optimization_history: objective per trial + best so far
- plot_param_importances: FANOVA-based feature ranking
- plot_parallel_coordinate: high-dim parameter relationships
- plot_contour: 2D params vs objective
- plot_slice: 1D objective slice
- plot_intermediate_values: learning curves
- plot_pareto_front: multi-objective Pareto

## Dash Integration
- All optuna.visualization returns go.Figure → dcc.Graph directly
- dcc.Interval for live refresh during optimization
- SQLite storage for persistence across sessions
- JournalFileBackend for multi-process parallelism

## Best Practices
- Min 10x parameters as n_trials
- Multi-objective reduces overfitting naturally
- Tight search spaces from domain knowledge
- Seed for reproducibility (sequential mode only)
- Cache price data outside objective

---
*Research completed: 2026-02-23*
