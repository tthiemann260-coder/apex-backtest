---
phase: 01-event-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pyproject.toml
  - src/__init__.py
  - src/events.py
  - tests/__init__.py
  - tests/test_events.py
autonomous: true

must_haves:
  truths:
    - "All four event dataclasses are frozen — mutating any field raises FrozenInstanceError"
    - "All financial fields use decimal.Decimal with string constructor — no float type annotations exist"
    - "SignalType restricts to exactly LONG, SHORT, EXIT — any other value is impossible"
    - "Event union type alias exists for downstream type hints"
  artifacts:
    - path: "src/events.py"
      provides: "Four immutable event dataclasses + three enums + Event union type"
      min_lines: 60
      contains: "@dataclass(frozen=True)"
    - path: "src/__init__.py"
      provides: "Package marker for src/"
    - path: "tests/__init__.py"
      provides: "Package marker for tests/"
    - path: "tests/test_events.py"
      provides: "Immutability, field type, enum, and Decimal precision tests"
      min_lines: 80
      contains: "FrozenInstanceError"
    - path: "pyproject.toml"
      provides: "Project configuration with pytest settings and pinned dependencies"
      contains: "apex-backtest"
  key_links:
    - from: "tests/test_events.py"
      to: "src/events.py"
      via: "import of all event classes and enums"
      pattern: "from src\\.events import"
---

<objective>
Bootstrap the apex-backtest project and implement all four immutable event dataclasses with their supporting enums, plus unit tests proving immutability and Decimal correctness.

Purpose: Events are the atomic unit of the entire EDA pipeline. Every downstream component (DataHandler, Strategy, Portfolio, Execution) produces or consumes these types. They must be immutable and Decimal-precise from day zero.

Output: pyproject.toml, src/events.py with 4 frozen dataclasses + 3 enums + Event union type, tests/test_events.py with immutability/type/enum/Decimal tests passing.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project scaffolding (pyproject.toml + package markers)</name>
  <files>pyproject.toml, src/__init__.py, tests/__init__.py</files>
  <action>
Create three files at the project root (`C:\Users\Tobias\OneDrive\Desktop\Backtest`):

1. **pyproject.toml** — Project configuration:
   - Build system: setuptools>=68
   - Project name: `apex-backtest`, version `0.1.0`, requires-python `>=3.12`
   - Dependencies (pinned): `pandas==2.2.3`, `numpy>=1.26`, `yfinance>=0.2`, `alpha_vantage>=2.3`, `pandas-ta>=0.3`, `dash>=2.17`, `plotly>=5.22`, `pyarrow>=15.0`
   - Optional dev dependencies: `pytest>=8.0`, `pytest-cov>=5.0`
   - `[tool.pytest.ini_options]`: testpaths = ["tests"], addopts = "-v --tb=short"
   - `[tool.coverage.run]`: source = ["src"]

2. **src/__init__.py** — Empty file (zero bytes). Marks `src` as a Python package.

3. **tests/__init__.py** — Empty file (zero bytes). Marks `tests` as a Python package.

Do NOT add any content to __init__.py files — they must be empty.
  </action>
  <verify>
Run: `python -c "import src; import tests; print('OK')"` from project root — must print OK.
Run: `python -c "import tomllib; d = tomllib.load(open('pyproject.toml','rb')); assert d['project']['name'] == 'apex-backtest'; print('OK')"` — must print OK.
  </verify>
  <done>pyproject.toml exists with correct project name, version, and pytest config. Both src/ and tests/ are importable Python packages.</done>
</task>

<task type="auto">
  <name>Task 2: Implement immutable event types and enums in src/events.py</name>
  <files>src/events.py</files>
  <action>
Create `src/events.py` with the following structure, in this exact order:

**Module docstring:**
```
"""
events.py — Immutable event types for the apex-backtest EDA pipeline.

All dataclasses are frozen (immutable after construction).
All financial fields use decimal.Decimal with string constructor:
    Decimal('123.45')  # correct
    Decimal(123.45)    # FORBIDDEN — floating-point imprecision
"""
```

**Imports:**
```python
from __future__ import annotations
from dataclasses import dataclass
from datetime import datetime
from decimal import Decimal
from enum import Enum
from typing import Optional
```

**Three enums (in this order):**

1. `SignalType(Enum)` — members: `LONG = "LONG"`, `SHORT = "SHORT"`, `EXIT = "EXIT"`
2. `OrderType(Enum)` — members: `MARKET = "MARKET"`, `LIMIT = "LIMIT"`, `STOP = "STOP"`
3. `OrderSide(Enum)` — members: `BUY = "BUY"`, `SELL = "SELL"`

**Four frozen dataclasses (in causal order):**

1. `MarketEvent(frozen=True)` — fields: `symbol: str`, `timestamp: datetime`, `open: Decimal`, `high: Decimal`, `low: Decimal`, `close: Decimal`, `volume: int`, `timeframe: str`
2. `SignalEvent(frozen=True)` — fields: `symbol: str`, `timestamp: datetime`, `signal_type: SignalType`, `strength: Decimal`
3. `OrderEvent(frozen=True)` — fields: `symbol: str`, `timestamp: datetime`, `order_type: OrderType`, `side: OrderSide`, `quantity: Decimal`, `price: Optional[Decimal]`
4. `FillEvent(frozen=True)` — fields: `symbol: str`, `timestamp: datetime`, `side: OrderSide`, `quantity: Decimal`, `fill_price: Decimal`, `commission: Decimal`, `slippage: Decimal`, `spread_cost: Decimal`

**Union type alias (after all dataclasses):**
```python
Event = MarketEvent | SignalEvent | OrderEvent | FillEvent
```

**RULES — NO EXCEPTIONS:**
- Every `@dataclass` MUST have `frozen=True`
- ZERO `float` type annotations anywhere in the file
- ALL financial fields typed as `Decimal`
- `volume` on MarketEvent is `int` (not Decimal — it counts units, not money)
- Use `Optional[Decimal]` for `OrderEvent.price` (None for MARKET orders)
  </action>
  <verify>
Run: `python -c "from src.events import MarketEvent, SignalEvent, OrderEvent, FillEvent, SignalType, OrderType, OrderSide, Event; print('OK')"` — must print OK.
Run: `python -c "from src.events import MarketEvent; from datetime import datetime; from decimal import Decimal; e = MarketEvent('AAPL', datetime.now(), Decimal('100'), Decimal('101'), Decimal('99'), Decimal('100.5'), 1000, '1d'); e.close = Decimal('999')"` — must raise FrozenInstanceError.
Verify no float: `grep -n 'float' src/events.py` — must return no matches.
  </verify>
  <done>All four event dataclasses are frozen and immutable. All financial fields use Decimal. Three enums exist with correct members. Event union type is exported. Zero float annotations.</done>
</task>

<task type="auto">
  <name>Task 3: Write test suite for event types (immutability + types + enums + Decimal)</name>
  <files>tests/test_events.py</files>
  <action>
Create `tests/test_events.py` with comprehensive tests. This test file validates the events module independently of the EventQueue (queue tests are in Plan 02).

**Module docstring:**
```
"""
test_events.py — Tests for apex-backtest event types.

Covers: frozen immutability, field types, enum values, Decimal correctness.
Run: pytest tests/test_events.py -v
"""
```

**Imports:**
```python
import pytest
from dataclasses import FrozenInstanceError
from datetime import datetime, timezone
from decimal import Decimal
from src.events import (
    MarketEvent, SignalEvent, OrderEvent, FillEvent,
    SignalType, OrderType, OrderSide, Event,
)
```

**Fixtures (reusable across test classes):**
- `now()` — returns `datetime(2024, 1, 15, 9, 30, 0, tzinfo=timezone.utc)`
- `market_event(now)` — AAPL MarketEvent with Decimal prices, volume=1_500_000, timeframe="1d"
- `signal_event(now)` — AAPL SignalEvent, SignalType.LONG, strength=Decimal("0.80")
- `order_event(now)` — AAPL OrderEvent, MARKET/BUY, quantity=Decimal("100"), price=None
- `fill_event(now)` — AAPL FillEvent, BUY, fill_price=Decimal("181.80"), commission/slippage/spread as Decimal

**Test classes (minimum 20 tests total):**

1. `TestFrozenImmutability` — 4 tests, one per event type. Each attempts field mutation, asserts `FrozenInstanceError`.

2. `TestFieldTypes` — 8 tests:
   - MarketEvent OHLC fields are all Decimal
   - MarketEvent volume is int (not bool)
   - MarketEvent symbol and timeframe are str
   - SignalEvent strength is Decimal
   - OrderEvent quantity is Decimal
   - OrderEvent price is None for MARKET
   - OrderEvent price is Decimal for LIMIT
   - FillEvent financial fields (quantity, fill_price, commission, slippage, spread_cost) are all Decimal

3. `TestEnums` — 5 tests:
   - SignalType has exactly 3 members with correct values
   - OrderType has exactly 3 members with correct values
   - OrderSide has exactly 2 members with correct values
   - SignalEvent.signal_type is SignalType instance
   - OrderEvent enums are correct types

4. `TestDecimalPrecision` — 4 tests:
   - String constructor preserves "0.10" exactly
   - Float constructor differs from string constructor (documents WHY we forbid float)
   - MarketEvent close exact value match
   - FillEvent commission exact value match

Each test uses `assert isinstance(...)` or `pytest.raises(...)` — never `pytest.approx()`.
  </action>
  <verify>
Run: `pytest tests/test_events.py -v --tb=short` — must exit code 0, all tests pass, zero warnings.
Run: `pytest tests/test_events.py -v --tb=short -q` — confirm "passed" appears and no "warning" in output.
  </verify>
  <done>test_events.py contains 20+ tests across 4 test classes. All pass with zero warnings. Every frozen dataclass has an immutability test. Every Decimal field has a type assertion. No pytest.approx() used anywhere.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python -c "from src.events import MarketEvent, SignalEvent, OrderEvent, FillEvent, SignalType, OrderType, OrderSide, Event; print('OK')"` prints OK
- [ ] `pytest tests/test_events.py -v --tb=short` exits 0, all tests pass, zero warnings
- [ ] `grep -n 'float' src/events.py` returns no matches
- [ ] Mutating any field on any frozen event raises FrozenInstanceError
- [ ] `python -m pytest --collect-only` shows no import errors
</verification>

<success_criteria>
- All 3 tasks completed
- pyproject.toml with correct project name, pytest config, and pinned dependencies
- src/events.py has 4 frozen dataclasses, 3 enums, Event union type, zero float annotations
- tests/test_events.py has 20+ passing tests with zero warnings
- All event classes use Decimal for financial fields (string constructor pattern)
</success_criteria>

<output>
After completion, create `.planning/phases/01-event-foundation/01-01-SUMMARY.md`
</output>
